<!-- templates/print_invoice.html -->
{% extends "base.html" %}

{% block title %}{{ language_dict['invoice'] }} #{{ invoice.invoice_number }}{% endblock %}

{% block content %}
<style>
    @media print {
        body {
            width: 210mm; /* A4 width */
            height: 297mm; /* A4 height */
            font-size: 12pt; /* Adjust font size for printing */
            margin: 0; /* Remove default margin */
            padding: 20mm; /* Add padding for print */
        }
        .no-print {
            display: none; /* Hide elements with class 'no-print' when printing */
        }
    }
</style>
 <!-- Persona Selection -->
    <!--<form method="GET" action="{{ url_for('print_invoice', invoice_id=invoice.id) }}">
        <label for="persona">Select Persona:</label>
        <select name="persona" id="persona">
            {% for key, persona in PERSONAS.items() %}
                <option value="{{ key }}">{{ persona.first_name }} {{ persona.last_name }}</option>
            {% endfor %}
        </select>
        <input type="hidden" name="language" value="{{ request.args.get('language', 'en') }}">
        <button type="submit" class="btn btn-info">Update</button>
    </form> -->
<div class="container mt-4">
    <div class="row">
        <div class="col">
    <h1 class="">{{ language_dict['invoice'] }} #{{ invoice.invoice_number }}</h1>
        </div>
        </div>
        <div class="row">
        <div class="col">
            <h3>{{ language_dict['recipient'] }}:</h3>
        </div>
        </div>
    <div class="row">
        <div class="col-6">
            <p><strong>{{ client.first_name }} {{ client.last_name }}</strong></p>
            {{ client.street }}</br>
            {{ client.city }}, {{ client.state }} {{ client.postal_code }}</br>
            {{ client.country }}</br>
            {{ language_dict['tel'] }}: {{ client.phone }}</br>
            {{ language_dict['email'] }}: {{ client.email }}</br>
            {{ language_dict['vat_number'] }}: {{ client.vat_number }}</br>
        </div>    
        <div class="col-6">
            <p class="text-right"><strong>{{ language_dict['date'] }}:</strong> {{ invoice.invoice_date.strftime('%Y-%m-%d') }}</p>
            <p class="text-right"><strong>{{ language_dict['invoice'] }} #:</strong> {{ invoice.invoice_number }}</p>
        </div>
    </div>

    

    

    <h3>{{ language_dict['services'] }}</h3>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>{{ language_dict['service'] }}</th>
                <th>{{ language_dict['unit_cost'] }}</th>
                <th>{{ language_dict['quantity'] }}</th>
                <th>{{ language_dict['line_total'] }}</th>
            </tr>
        </thead>
        <tbody>
            {% for service in services %}
            <tr>
                <td>{{ service.service }}</td>
                <td>{{ service.unit_cost }} {{ invoice.currency }}</td>
                <td>{{ service.quantity }}</td>
                <td>{{ service.line_total }} {{ invoice.currency }}</td>
            </tr>
            {% endfor %}
            <tr>
                <td></td>
                <td></td>
                <td><strong>{{ language_dict['subtotal'] }}</strong></td>
                <td><strong>{{ subtotal }} {{ invoice.currency }}</strong></td>
            </tr>
            {% if discount > 0 %}
            <tr>
                <td></td>
                <td></td>
                <td>{{ language_dict['discount'] }}</td>
                <td>{{ discount }} %</td>
            </tr>
            {% endif %}
            {% if vat_amount > 0 %}
            <tr>
                <td></td>
                <td></td>
                <td>{{ language_dict['vat'] }} ({{ invoice.vat_percentage }}%)</td>
                <td>{{ vat_amount }}</td>
            </tr>
            {% endif %}
        </tbody>
    </table>

    
    <h4>{{ language_dict['total'] }}: {{ total }} {{ invoice.currency }}</h4>
    <div class="row">
        <div class="col">
            <strong>{{ language_dict['client_terms'] }}</strong>
            <p>{{ client_payment_terms }}<p>
            </div>
            </div>
    <p>{{ language_dict['transfer_text'] }}</p>

    <div class="container mt-4">
        <div class="row">
            <div class="col">
        <strong>{{ persona_info.prefix }} {{ persona_info.first_name }} {{ persona_info.last_name }} {{ persona_info.suffix }}</strong></br>
        {{ persona_info.address.street }}</br>
        {{ persona_info.address.city }}, {{ persona_info.address.state }} {{ persona_info.address.postal_code}}</br>
        {{ persona_info.address.country }}</br>
        {{ language_dict['tel'] }}: {{ persona_info.tel }}</br>
        {{ language_dict['email'] }}: {{ persona_info.email }}</br>
        {{ language_dict['vat_number'] }}: {{ persona_info.vat_number }}</br>
    </div>
    <div class="col">
    <strong>{{ language_dict['bank_info'] }}</strong></br>
    {{ persona_info.bank_info.account_holder }}</br>
    Bank Name: {{ persona_info.bank_info.bank_name }}</br>
    IBAN: {{ persona_info.bank_info.iban }}</br>
    BIC: {{ persona_info.bank_info.bic }}</br>
</div>
</div>

    <!-- Print and Download Buttons -->
    <div class="mt-4 no-print">
        <button class="btn btn-primary" onclick="window.print();">Print Invoice</button>
        <button class="btn btn-success" id="downloadInvoice">Download Invoice as PDF</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
    // JavaScript to handle the download functionality
    document.getElementById('downloadInvoice').addEventListener('click', function() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Get the content of the invoice
        const invoiceContent = document.querySelector('.container').innerHTML;

        // Add the content to the PDF
        doc.fromHTML(invoiceContent, 15, 15, {
            'width': 170
        });

        // Save the PDF
        doc.save('invoice.pdf');
    });
</script>
{% endblock %}
